

%form#daylog{:method=>"post",:action=>"/log"}
  %section#main
    -#%h5 Hello world
  -index = 0
  -$mapping.each do |room,systems|
    %section{:id=>room.slug}
      -#%h5.hide-on-med-and-down= room
      .row
        -systems.each do |system,measurements|
          .col.s12.m6.offset-m3
            .card{:class=>system.slug,:id=>"#{room.slug}_#{system.slug}"}
              .card-content
                .clearfix
                  .left.card-valid
                    %i.prefix.material-icons.grey-text{:style=>"font-size:32px;display:none;"} check_circle
                    &nbsp;
                  .left
                    %span.card-title=system
                  .switch.right.sys
                    %label
                      %input.check{:type=>"checkbox", :name=>"#{room.slug}_#{system.slug}"}
                      %span.lever
              .card-action.off
                -measurements.each do |measurement,specs|
                  -id = "#{room.slug}_#{system.slug}_#{measurement.slug}"
                  -dirt = [nil,nil,nil]
                  -if specs.has_key? "data" 
                    -if specs["unit"] == "enum"
                      -dirt = [nil,nil,"dev"]
                    -else
                      -dirt = ["display:none;",specs["data"],"devhide "+specs["data"].slug]
                      -measurement = measurement.sub(/^#{specs["data"]}\s+/,"")
                  -elsif specs["unit"] == "binary"
                    -dirt = [nil,nil,"sw"]

                  .input-field{:style=>dirt[0],"data-name"=>dirt[1],:class=>dirt[2]}
                    -if specs["unit"] == "enum"
                      %i.material-icons.prefix.grey-text.maybe chevron_right
                      %i.material-icons.prefix.teal-text.yes check
                      %i.material-icons.prefix.red-text.text-darken-4.no close
                      %select{:validate=>true,:name=>id}
                        %option{:value=>"nil",:disabled=>true,:selected=>true}= measurement
                        -if specs.has_key? "data"
                          -specs["data"].split("|").each do |option|
                            %option{:value=>option.slug}= option
                        -else
                          -[*specs["min"].to_i..specs["max"].to_i].each do |option|
                            %option{:value=>option}= measurement.sub("#",option.to_s)
                      %label=measurement
                    -elsif specs["unit"] == "binary"
                      -#%i.material-icons.prefix.grey-text.maybe chevron_right
                      %i.material-icons.prefix.teal-text.yes check
                      %i.material-icons.prefix.teal-text.maybe check
                      %input.checkhide{:type=>"hidden", :name=>id, :value=>"off"}
                      -#%i.material-icons.prefix.red-text.text-darken-4.no close
                      .clearfix
                        .left
                          %label{:for=>id}= measurement
                        .switch.right
                          %label
                            &nbsp; &nbsp; Off
                            %input.check{:type=>"checkbox", :name=>id}
                            %span.lever
                            On
                  
                    -else
                      %i.material-icons.prefix.grey-text.maybe chevron_right
                      %i.material-icons.prefix.teal-text.yes check
                      %i.material-icons.prefix.red-text.text-darken-4.no close
                      %input{ :id => id,
                        :type => "number",
                        :name => id,
                        :step => ["cube","bar"].include?(specs["unit"]) ? 0.01 : 1,
                        :min  => specs.has_key?("min") ? specs["min"] : nil,
                        :max  => specs.has_key?("max") ? specs["max"] : nil,
                        #:required => true,
                        :validate => true } 
                      -#,:placeholder=>id}
                      %label{:for=>id}= measurement

        -if $lubrication.has_key?(room)
          .col.s12.m6.offset-m3
            .card.lubrication{:id=>"#{room.slug}_lubrication"}
              .card-content
                .clearfix
                  .left.card-valid
                    %i.card-valid.prefix.material-icons.black-text.large{:style=>"font-size:32px;"} opacity
                    &nbsp;
                  .left
                    %span.card-title Lubrication
                  .right
                    %a.lube-add
                      %i.card-valid.prefix.material-icons.teal-text{:style=>"font-size:32px;"} add_circle
              .card-action.off
                %table
                  %thead
                    %tr
                      %th Unit
                      %th Oil Type
                      %th Amount
                      %th &nbsp;
                  %tbody
                    
      .row
        .col.s12.foot-arrows
          %br/
          -if index > 0
            .left
              %a.btn-large.btn-floating.waves-effect.waves-light{:href=>"##{$mapping.keys[index-1].slug}"}
                %i.material-icons chevron_left
          -if index < $mapping.keys.length - 1
            .right
              %a.btn-large.btn-floating.waves-effect.waves-light{:href=>"##{$mapping.keys[index+1].slug}"}
                %i.material-icons chevron_right
          -else
            .right
              %a.btn-large.btn-floating.waves-effect.waves-light{:href=>"#submit"}
                %i.material-icons send
          %br/
          %br/
          %br/

    -index += 1

  %section#submit
    %h5.hide-on-med-and-down Submit results
    .row
      .col.s12
        .card
          .card-content
            .row
              .col.s12
                .clearfix
                  %span.left.card-title Submit
                  -#.right.card-valid
                    %i.material-icons.teal-text{:style=>"font-size:32px;display:none;"} check_circle
              .col.s12.m6
                .input-field
                  %input.datepicker.ex{:validate=>true,:required=>true,:name=>"date",:type=>"text",:value=>Date.today.strftime("%b %d, %Y")}
                  %label{:for=>"date"} Date
              .col.s12.m6
                .input-field
                  %input.ex{:validate=>true,:required=>true,:name=>"user",:type=>"text"}
                  %label{:for=>"date"} Duty engineer
              .col.s12
                .input-field
                  %textarea.materialize-textarea{:name=>"notes"}
                  %label{:for=>"notes"} Notes
              .col.s12.errors
                .card.red.darken-4
                  .card-content
                    .clearfix
                      %span.left.title.white-text Following problems encountered:
                    %ul.content

              .col.s8.offset-s2.m6.offset-m3
                .input-field
                  %button.btn.full.submit.large
                    %i.material-icons.right.large send
                    .large SEND FORM
